<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Return an interpolating function for populations in 1y age increments — get_age_population_function • conmat</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Return an interpolating function for populations in 1y age increments — get_age_population_function"><meta property="og:description" content="This function returns an interpolating function to get
populations in 1y age increments from chunkier distributions produced by
socialmixr::wpp_age()."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">conmat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/getting-started.html">Getting Started</a>
</li>
<li>
  <a href="../articles/example-pipeline.Rmd">Example Pipeline</a>
</li>
<li>
  <a href="../articles/data-sources.Rmd">Data Sources</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"></ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Return an interpolating function for populations in 1y age increments</h1>
    
    <div class="hidden name"><code>get_age_population_function.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function returns an interpolating function to get
populations in 1y age increments from chunkier distributions produced by
<code><a href="https://epiforecasts.io/socialmixr/reference/wpp_age.html" class="external-link">socialmixr::wpp_age()</a></code>.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">get_age_population_function</span><span class="op">(</span><span class="va">data</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for conmat_population</span></span>
<span><span class="fu">get_age_population_function</span><span class="op">(</span>data <span class="op">=</span> <span class="va">population</span>, <span class="va">...</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># S3 method for data.frame</span></span>
<span><span class="fu">get_age_population_function</span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">population</span>,</span>
<span>  age_col <span class="op">=</span> <span class="va">lower.age.limit</span>,</span>
<span>  pop_col <span class="op">=</span> <span class="va">population</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>data</dt>
<dd><p>dataset containing information on population of a given
age/age group</p></dd>


<dt>...</dt>
<dd><p>extra arguments</p></dd>


<dt>age_col</dt>
<dd><p>bare variable name for the column with age information</p></dd>


<dt>pop_col</dt>
<dd><p>bare variable name for the column with population information</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>An interpolating function to get populations in 1y age increments</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>The function first prepares the data to fit a smoothing spline to
the data for ages below the maximum age. It arranges the data by the lower
limit of the age group to obtain the bin width/differences of the lower
age limits. The mid point of the bin width is later added to the ages and
the population is scaled as per the bin widths. The maximum age is later
obtained and the populations for different above and below are filtered out
along with the sum of populations with and without maximum age. A cubic
smoothing spline is then fitted to the data for ages below the maximum with
predictor variable as the ages with the mid point of the bins added to it
where as the response variable is the log-scaled population. Using the
smoothing spline fit, the predicted population of ages 0 to 200 is obtained
and the predicted population is adjusted further using a ratio of the sum
of the population across all ages from the data and predicted population.
The ratio is based on whether the ages are under the maximum age as the
total population across all ages differs for ages above and below the
maximum age. The maximum age population is adjusted further to drop off
smoothly, based on the weights. The final population is then linearly
extrapolated over years past the upper bound from the data. For ages above
the maximum age from data, the population is calculated as a weighted
population of the maximum age that depends on the years past the upper
bound. Older ages would have lower weights, therefore lower population.</p>
    </div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">polymod_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="get_polymod_population.html">get_polymod_population</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">polymod_pop</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 21 × 2</span> <span style="color: #BB0000;">(conmat_population)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #555555;">- age: </span><span style="color: #555555; font-weight: bold;">lower.age.limit</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #555555;">- population: </span><span style="color: #555555; font-weight: bold;">population</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    lower.age.limit population</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 1</span>               0   1<span style="text-decoration: underline;">852</span>682.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 2</span>               5   1<span style="text-decoration: underline;">968</span>449.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 3</span>              10   2<span style="text-decoration: underline;">138</span>897.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 4</span>              15   2<span style="text-decoration: underline;">312</span>032.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 5</span>              20   2<span style="text-decoration: underline;">407</span>486.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 6</span>              25   2<span style="text-decoration: underline;">423</span>602.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 7</span>              30   2<span style="text-decoration: underline;">585</span>137.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 8</span>              35   2<span style="text-decoration: underline;">969</span>393.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;"> 9</span>              40   3<span style="text-decoration: underline;">041</span>663.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">10</span>              45   2<span style="text-decoration: underline;">809</span>154.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with 11 more rows</span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># But these ages and populations are binned every 5 years. So we can now</span></span></span>
<span class="r-in"><span><span class="co"># provide a specified age and get the estimated population for that 1 year</span></span></span>
<span class="r-in"><span><span class="co"># age group. First we create the new function like so</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">age_pop_function</span> <span class="op">&lt;-</span> <span class="fu">get_age_population_function</span><span class="op">(</span></span></span>
<span class="r-in"><span>  data <span class="op">=</span> <span class="va">polymod_pop</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># Then we pass it a year to get the estimated population for a particular age</span></span></span>
<span class="r-in"><span><span class="fu">age_pop_function</span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 375940</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Or a vector of years, to get the estimated population for a particular age</span></span></span>
<span class="r-in"><span><span class="co"># range</span></span></span>
<span class="r-in"><span><span class="fu">age_pop_function</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 360379.5 365489.5 370672.4 375940.0</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Notice that we get a _pretty similar_ number of 0-4 if we sum it up, as</span></span></span>
<span class="r-in"><span><span class="co"># the first row of the table:</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">polymod_pop</span>, <span class="fl">1</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 1 × 2</span> <span style="color: #BB0000;">(conmat_population)</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #555555;">- age: </span><span style="color: #555555; font-weight: bold;">lower.age.limit</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  <span style="color: #555555;">- population: </span><span style="color: #555555; font-weight: bold;">population</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   lower.age.limit population</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>               0   1<span style="text-decoration: underline;">852</span>682.</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu">age_pop_function</span><span class="op">(</span>age <span class="op">=</span> <span class="fl">0</span><span class="op">:</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1827822</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Usage in dplyr</span></span></span>
<span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">example_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice_head</a></span><span class="op">(</span><span class="va">abs_education_state</span>, n <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">example_df</span> <span class="op"><a href="pipe.html">%&gt;%</a></span></span></span>
<span class="r-in"><span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>population_est <span class="op">=</span> <span class="fu">age_pop_function</span><span class="op">(</span><span class="va">age</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># A tibble: 5 × 6</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    year state aboriginal_and_torres_strait_islander_status   age n_ful…¹ popul…²</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                                        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">1</span>  <span style="text-decoration: underline;">2</span>006 ACT   Aboriginal and Torres Strait Islander            4       5 <span style="text-decoration: underline;">375</span>940.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">2</span>  <span style="text-decoration: underline;">2</span>006 ACT   Non-Indigenous                                   4     109 <span style="text-decoration: underline;">375</span>940.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">3</span>  <span style="text-decoration: underline;">2</span>006 NSW   Aboriginal and Torres Strait Islander            4     104 <span style="text-decoration: underline;">375</span>940.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">4</span>  <span style="text-decoration: underline;">2</span>006 NSW   Non-Indigenous                                   4    <span style="text-decoration: underline;">1</span>870 <span style="text-decoration: underline;">375</span>940.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #BCBCBC;">5</span>  <span style="text-decoration: underline;">2</span>006 NT    Aboriginal and Torres Strait Islander            4     102 <span style="text-decoration: underline;">375</span>940.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> <span style="color: #949494;"># … with abbreviated variable names ¹​n_full_and_part_time, ²​population_est</span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Nicholas Tierney, Nick Golding, Aarathy Babu.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

