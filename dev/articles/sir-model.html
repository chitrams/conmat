<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="conmat">
<title>SIR modelling with conmat • conmat</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SIR modelling with conmat">
<meta property="og:description" content="conmat">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-dark navbar-expand-lg bg-primary"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">conmat</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="In-development version">0.0.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/conmat-population.html">Conmat Population Data</a>
    <a class="dropdown-item" href="../articles/data-sources.html">Data Sources</a>
    <a class="dropdown-item" href="../articles/example-pipeline.html">Example Pipeline</a>
    <a class="dropdown-item" href="../articles/getting-started.html">Getting Started</a>
    <a class="dropdown-item" href="../articles/other-data-sources.html">Using other data sources</a>
    <a class="dropdown-item" href="../articles/parallel-computing.html">Parallel Computing</a>
    <a class="dropdown-item" href="../articles/sir-model.html">SIR modelling with conmat</a>
    <a class="dropdown-item" href="../articles/visualising-conmat.html">Visualisation gallery</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>SIR modelling with conmat</h1>
            
      
      
      <div class="d-none name"><code>sir-model.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">conmat</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://desolve.r-forge.r-project.org/" class="external-link">deSolve</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://purrr.tidyverse.org/" class="external-link">purrr</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="introduction-what-is-an-sir-model">Introduction: What is an SIR model?<a class="anchor" aria-label="anchor" href="#introduction-what-is-an-sir-model"></a>
</h2>
<p>SIR (Susceptible, Infected, Recovered) models, sometimes known as <a href="https://en.wikipedia.org/wiki/Compartmental_models_in_epidemiology" class="external-link">compartmental
models</a>, are a mathematical modelling technique used to understand
facets of an epidemic. They can help answer questions like:</p>
<ul>
<li>What is the duration of an epidemic?</li>
<li>What is the total number of infected people?</li>
<li>How does the disease spread?</li>
<li>What is the reproductive number?</li>
<li>What is the impact of a public health intervention?</li>
</ul>
<p>The <strong>SIR</strong> refers to the number of:</p>
<ul>
<li>S: <em>s</em>usceptible</li>
<li>I: <em>i</em>nfected</li>
<li>R: <em>r</em>ecovered / <em>r</em>emoved</li>
</ul>
<p>people at a given time point. We can model how these numbers change
at each time step, based on initial population numbers, and other
parameters like how infection spreads (is it more likely to infect
younger or older people?),</p>
</div>
<div class="section level2">
<h2 id="an-sir-model-with-homogenous-mixing">An SIR Model with homogenous mixing<a class="anchor" aria-label="anchor" href="#an-sir-model-with-homogenous-mixing"></a>
</h2>
<p>We start with a complicated version of a relatively simple model: an
age-stratified SIR Model, but with all age groups acting exactly the
same.</p>
<p>We will use 17 age groups, each in 5 year age bands, and turn these
into a <code>conmat_population</code> object. This is an object that
knows which columns represent age and population, which is used by other
functions within <code>conmat</code>.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">homogeneous_population</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span></span>
<span>  age <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">100</span>, times <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>  <span class="fu"><a href="../reference/as_conmat_population.html">as_conmat_population</a></span><span class="op">(</span></span>
<span>    age <span class="op">=</span> <span class="va">age</span>,</span>
<span>    population <span class="op">=</span> <span class="va">population</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">homogeneous_population</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 9 × 2</span> <span style="color: #BB0000;">(conmat_population)</span></span></span>
<span><span class="co">#&gt;  <span style="color: #555555;">- age: </span><span style="color: #555555; font-weight: bold;">age</span></span></span>
<span><span class="co">#&gt;  <span style="color: #555555;">- population: </span><span style="color: #555555; font-weight: bold;">population</span></span></span>
<span><span class="co">#&gt;     age population</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>     0        100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>    10        100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>    20        100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>    30        100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>    40        100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>    50        100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">7</span>    60        100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">8</span>    70        100</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">9</span>    80        100</span></span></code></pre></div>
<p>Then, we extrapolate these into a set of contact matrices, which we
can construct using <code>setting_prediction_matrix</code>. We set these
as matrices of 1 - the contact rate is homogenous and exactly the
same.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_breaks_0_80_plus</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="va">mat_ones</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">1</span>, nrow <span class="op">=</span> <span class="fl">9</span>, ncol <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Relative number of contacts between individuals in 2 age categories</span></span>
<span><span class="co"># Think of as P(contact)</span></span>
<span><span class="va">homogeneous_contact</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/setting_prediction_matrix.html">setting_prediction_matrix</a></span><span class="op">(</span></span>
<span>  home <span class="op">=</span> <span class="va">mat_ones</span>,</span>
<span>  work <span class="op">=</span> <span class="va">mat_ones</span>,</span>
<span>  school <span class="op">=</span> <span class="va">mat_ones</span>,</span>
<span>  other <span class="op">=</span> <span class="va">mat_ones</span>,</span>
<span>  age_breaks <span class="op">=</span> <span class="va">age_breaks_0_80_plus</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">homogeneous_contact</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Setting Prediction Matrices</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">A list of matrices containing the model predicted contact rate between ages in</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">each setting.</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">There are 9 age breaks, ranging 0-80+ years, with a regular 10 year interval</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">home</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">work</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">school</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">all</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Access each <span style="color: #0000BB;">&lt;matrix&gt;</span> with `x$name`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> e.g., `x$home`</span></span></code></pre></div>
<p>Similarly, we construct a set of transmission matrices, which provide
the probability of transmission for each age group, using
<code>transmission_probability_matrix</code>. These all have the same
transmission probability - 0.05 (1 in 20).</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mat_05</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.05</span>, nrow <span class="op">=</span> <span class="fl">9</span>, ncol <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">transmission_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmission_probability_matrix.html">transmission_probability_matrix</a></span><span class="op">(</span></span>
<span>  home <span class="op">=</span> <span class="va">mat_05</span>,</span>
<span>  work <span class="op">=</span> <span class="va">mat_05</span>,</span>
<span>  school <span class="op">=</span> <span class="va">mat_05</span>,</span>
<span>  other <span class="op">=</span> <span class="va">mat_05</span>,</span>
<span>  age_breaks <span class="op">=</span> <span class="va">age_breaks_0_80_plus</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">transmission_matrix</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Transmission Probability Matrices</span> <span style="color: #00BBBB;">───────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">A list of matrices, each </span><span style="color: #0000BB; font-style: italic;">&lt;matrix&gt;</span><span style="font-style: italic;"> containing the </span><span style="font-weight: bold; font-style: italic;">relative</span><span style="font-style: italic;"> probability of</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">individuals in a given age group infecting an individual in another age group,</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">for that setting.</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">There are 9 age breaks, ranging 0-80+ years, with a regular 10 year interval</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">home</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">work</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">school</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Access each <span style="color: #0000BB;">&lt;matrix&gt;</span> with `x$name`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> e.g., `x$home`</span></span></code></pre></div>
<p>We also need to set up our population structures. We’ll have all the
S states, then I, then R. Since we’re using <code>deSolve</code> to
solve this system, we need to make sure this order stays the same
throughout!</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">S0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">999</span>, times <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">I0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, times <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">R0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, times <span class="op">=</span> <span class="fl">9</span><span class="op">)</span></span>
<span><span class="va">initial_condition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">S0</span>, <span class="va">I0</span>, <span class="va">R0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">initial_condition</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S0"</span>, <span class="st">"I0"</span>, <span class="st">"R0"</span><span class="op">)</span>, each <span class="op">=</span> <span class="fl">9</span><span class="op">)</span>,</span>
<span>  <span class="va">age_breaks_0_80_plus</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">9</span><span class="op">]</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">"_"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">initial_condition</span></span>
<span><span class="co">#&gt;  S0_0 S0_10 S0_20 S0_30 S0_40 S0_50 S0_60 S0_70 S0_80  I0_0 I0_10 I0_20 I0_30 </span></span>
<span><span class="co">#&gt;   999   999   999   999   999   999   999   999   999     1     1     1     1 </span></span>
<span><span class="co">#&gt; I0_40 I0_50 I0_60 I0_70 I0_80  R0_0 R0_10 R0_20 R0_30 R0_40 R0_50 R0_60 R0_70 </span></span>
<span><span class="co">#&gt;     1     1     1     1     1     0     0     0     0     0     0     0     0 </span></span>
<span><span class="co">#&gt; R0_80 </span></span>
<span><span class="co">#&gt;     0</span></span></code></pre></div>
<p>For an SIR model, we need to compute the <em>force of infection</em>,
which is <span class="math display">\[\lambda(t) = \beta I(t).\]</span>
The <span class="math inline">\(\beta\)</span> term is the product of
the probability of infection given contact, and the probability of
contact, for which we can use the matrices we have just defined:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"transmission_matrix"</span> <span class="op">=</span> <span class="va">transmission_matrix</span>,</span>
<span>  <span class="st">"homogeneous_contact"</span> <span class="op">=</span> <span class="va">homogeneous_contact</span>,</span>
<span>  <span class="st">"gamma"</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="st">"s_indexes"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">9</span>,</span>
<span>  <span class="st">"i_indexes"</span> <span class="op">=</span> <span class="fl">10</span><span class="op">:</span><span class="fl">18</span>,</span>
<span>  <span class="st">"r_indexes"</span> <span class="op">=</span> <span class="fl">19</span><span class="op">:</span><span class="fl">27</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">parameters</span></span>
<span><span class="co">#&gt; $transmission_matrix</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Transmission Probability Matrices</span> <span style="color: #00BBBB;">───────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">A list of matrices, each </span><span style="color: #0000BB; font-style: italic;">&lt;matrix&gt;</span><span style="font-style: italic;"> containing the </span><span style="font-weight: bold; font-style: italic;">relative</span><span style="font-style: italic;"> probability of</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">individuals in a given age group infecting an individual in another age group,</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">for that setting.</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">There are 9 age breaks, ranging 0-80+ years, with a regular 10 year interval</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">home</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">work</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">school</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Access each <span style="color: #0000BB;">&lt;matrix&gt;</span> with `x$name`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> e.g., `x$home`</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $homogeneous_contact</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Setting Prediction Matrices</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">A list of matrices containing the model predicted contact rate between ages in</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">each setting.</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">There are 9 age breaks, ranging 0-80+ years, with a regular 10 year interval</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">home</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">work</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">school</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">all</span>: a 9x9 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Access each <span style="color: #0000BB;">&lt;matrix&gt;</span> with `x$name`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> e.g., `x$home`</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $gamma</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $s_indexes</span></span>
<span><span class="co">#&gt; [1] 1 2 3 4 5 6 7 8 9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $i_indexes</span></span>
<span><span class="co">#&gt; [1] 10 11 12 13 14 15 16 17 18</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $r_indexes</span></span>
<span><span class="co">#&gt; [1] 19 20 21 22 23 24 25 26 27</span></span></code></pre></div>
<p>Now we construct a function for the age structured SIR model, to pass
to deSolve. This calculates the force of infection for each setting.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_structured_sir</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">state</span>, <span class="va">parameters</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># Calculate the force of infection for each setting:</span></span>
<span>  <span class="co"># unstructured SIR beta is age_group_n / pop_n</span></span>
<span></span>
<span>  <span class="va">N_by_age</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map_dbl</a></span><span class="op">(</span></span>
<span>    .x <span class="op">=</span> <span class="va">parameters</span><span class="op">$</span><span class="va">s_indexes</span>,</span>
<span>    .f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">current_indexes_to_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="va">parameters</span><span class="op">$</span><span class="va">s_indexes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>        <span class="va">parameters</span><span class="op">$</span><span class="va">i_indexes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>,</span>
<span>        <span class="va">parameters</span><span class="op">$</span><span class="va">r_indexes</span><span class="op">[</span><span class="va">i</span><span class="op">]</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">state</span><span class="op">[</span><span class="va">current_indexes_to_sum</span><span class="op">]</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># normalise by the age population</span></span>
<span>  <span class="va">N_infected_by_age</span> <span class="op">&lt;-</span> <span class="va">state</span><span class="op">[</span><span class="va">parameters</span><span class="op">$</span><span class="va">i_indexes</span><span class="op">]</span> <span class="op">/</span> <span class="va">N_by_age</span></span>
<span></span>
<span>  <span class="co"># functional method for takign the product of two matrices</span></span>
<span>  <span class="va">product</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">transmission</span>, <span class="va">contact</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map2.html" class="external-link">map2</a></span><span class="op">(</span><span class="va">transmission</span>, <span class="va">contact</span>, <span class="va">`*`</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">age_normalise</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># matrix multiply by infected and normalise by age population</span></span>
<span>    <span class="fu"><a href="https://purrr.tidyverse.org/reference/map.html" class="external-link">map</a></span><span class="op">(</span><span class="va">beta</span>, <span class="kw">function</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">beta</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">N_infected_by_age</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">lambdas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>    setting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">parameters</span><span class="op">$</span><span class="va">transmission_matrix</span><span class="op">)</span>,</span>
<span>    transmission_matrix <span class="op">=</span> <span class="va">parameters</span><span class="op">$</span><span class="va">transmission_matrix</span>,</span>
<span>    homogeneous_contact <span class="op">=</span> <span class="va">parameters</span><span class="op">$</span><span class="va">homogeneous_contact</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>      beta <span class="op">=</span> <span class="fu">product</span><span class="op">(</span><span class="va">transmission_matrix</span>, <span class="va">homogeneous_contact</span><span class="op">)</span>,</span>
<span>      lambda <span class="op">=</span> <span class="fu">age_normalise</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Combine them all into one term for ease of computation</span></span>
<span>  <span class="va">lambda_total</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/funprog.html" class="external-link">Reduce</a></span><span class="op">(</span><span class="st">"+"</span>, <span class="va">lambdas</span><span class="op">$</span><span class="va">lambda</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># Don't forget to normalise your infection rate by the population!</span></span>
<span>  <span class="va">dSdt</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">lambda_total</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">parameters</span><span class="op">$</span><span class="va">s_indexes</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">dIdt</span> <span class="op">&lt;-</span> <span class="va">lambda_total</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">parameters</span><span class="op">$</span><span class="va">s_indexes</span><span class="op">]</span> <span class="op">-</span></span>
<span>    <span class="va">parameters</span><span class="op">$</span><span class="va">gamma</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">parameters</span><span class="op">$</span><span class="va">i_indexes</span><span class="op">]</span></span>
<span></span>
<span>  <span class="va">dRdt</span> <span class="op">&lt;-</span> <span class="va">parameters</span><span class="op">$</span><span class="va">gamma</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="va">parameters</span><span class="op">$</span><span class="va">i_indexes</span><span class="op">]</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="va">dSdt</span>,</span>
<span>        <span class="va">dIdt</span>,</span>
<span>        <span class="va">dRdt</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Then we solve the ODE like so:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">homogeneous_soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">initial_condition</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  func <span class="op">=</span> <span class="va">age_structured_sir</span>,</span>
<span>  parms <span class="op">=</span> <span class="va">parameters</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Have to convert ode output to a data frame to do any plotting</span></span>
<span><span class="va">homogeneous_soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">homogeneous_soln</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Now, let’s compare this to an SIR model with no stratification - as
in, no age groups:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parameters_sir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"beta"</span> <span class="op">=</span> <span class="fl">1.8</span>, <span class="st">"gamma"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">initial_condition_sir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span> <span class="op">=</span> <span class="fl">8991</span>, <span class="st">"I"</span> <span class="op">=</span> <span class="fl">9</span>, <span class="st">"R"</span> <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sir</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">time</span>, <span class="va">state</span>, <span class="va">parameters</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">state</span><span class="op">)</span></span>
<span>  <span class="va">lambda_total</span> <span class="op">&lt;-</span> <span class="va">parameters</span><span class="op">[</span><span class="st">"beta"</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="st">"I"</span><span class="op">]</span></span>
<span>  <span class="va">dSdt</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">lambda_total</span> <span class="op">/</span> <span class="va">N</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="st">"S"</span><span class="op">]</span></span>
<span>  <span class="va">dIdt</span> <span class="op">&lt;-</span> <span class="va">parameters</span><span class="op">[</span><span class="st">"beta"</span><span class="op">]</span> <span class="op">/</span> <span class="va">N</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="st">"S"</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="st">"I"</span><span class="op">]</span> <span class="op">-</span> <span class="va">parameters</span><span class="op">[</span><span class="st">"gamma"</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="st">"I"</span><span class="op">]</span></span>
<span>  <span class="va">dRdt</span> <span class="op">&lt;-</span> <span class="va">parameters</span><span class="op">[</span><span class="st">"gamma"</span><span class="op">]</span> <span class="op">*</span> <span class="va">state</span><span class="op">[</span><span class="st">"I"</span><span class="op">]</span></span>
<span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">dSdt</span>, <span class="va">dIdt</span>, <span class="va">dRdt</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">sir_soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">initial_condition_sir</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  func <span class="op">=</span> <span class="va">sir</span>,</span>
<span>  parms <span class="op">=</span> <span class="va">parameters_sir</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">sir_soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">sir_soln</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ungrouped_structure</span> <span class="op">&lt;-</span> <span class="va">sir_soln</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">time</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we are going to tidy up ODE output a few times, so wrap it into a function:</span></span>
<span><span class="va">tidy_ode</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">ode_soln</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ode_soln</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">time</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>parent_state <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/substr.html" class="external-link">substr</a></span><span class="op">(</span><span class="va">name</span>, <span class="fl">1</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">parent_state</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>value <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">parent_state</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># For the stratified model, we have to add up all the age categories together for a fair comparison.</span></span>
<span><span class="va">grouped_structure</span> <span class="op">&lt;-</span> <span class="fu">tidy_ode</span><span class="op">(</span><span class="va">homogeneous_soln</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'time'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="va">combined_solutions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  <span class="st">"non_structured"</span> <span class="op">=</span> <span class="va">ungrouped_structure</span>,</span>
<span>  <span class="st">"age_structured"</span> <span class="op">=</span> <span class="va">grouped_structure</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"type"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">combined_solutions</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 1,206 × 4</span></span></span>
<span><span class="co">#&gt;    type            time name     value</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> non_structured   0   S     <span style="text-decoration: underline;">8</span>991    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> non_structured   0   I        9    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> non_structured   0   R        0    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> non_structured   0.1 S     <span style="text-decoration: underline;">8</span>989.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> non_structured   0.1 I        9.75 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> non_structured   0.1 R        0.937</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> non_structured   0.2 S     <span style="text-decoration: underline;">8</span>987.   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> non_structured   0.2 I       10.6  </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> non_structured   0.2 R        1.95 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> non_structured   0.3 S     <span style="text-decoration: underline;">8</span>986.   </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 1,196 more rows</span></span></span></code></pre></div>
<p>Now let’s plot these two models approaches - the age structure and
the non age structured:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_combined_solutions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">combined_solutions</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">name</span>, linetype <span class="op">=</span> <span class="va">type</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, colour <span class="op">=</span> <span class="st">"State"</span>, linetype <span class="op">=</span> <span class="st">"Model"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_combined_solutions</span></span></code></pre></div>
<p><img src="sir-model_files/figure-html/plot-both-models-1.png" width="700"></p>
<p>Voila! These lines are the same! We can double check this by plotting
them as facets:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_combined_solutions</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">type</span><span class="op">)</span></span></code></pre></div>
<p><img src="sir-model_files/figure-html/facetted-sir-1.png" width="700"></p>
<p>So, we have successfully collapsed our stratified model down to the
non-stratified model, which is a great sense check for every time you
write out a complicated model.</p>
</div>
<div class="section level2">
<h2 id="comparison-to-other-age-matrices">Comparison to other age matrices<a class="anchor" aria-label="anchor" href="#comparison-to-other-age-matrices"></a>
</h2>
<p>Now that we’ve established an age-structured SIR model, we can repeat
the process with <code>conmat</code> matrices. This process is the same
as in the vignette, “Data Sources”.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">world_data</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="fu"><a href="https://epiforecasts.io/socialmixr/reference/wpp_age.html" class="external-link">wpp_age</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    new_lower_age <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/if_else.html" class="external-link">if_else</a></span><span class="op">(</span><span class="va">lower.age.limit</span> <span class="op">&gt;=</span> <span class="fl">75</span>, <span class="fl">75L</span>, <span class="va">lower.age.limit</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">new_lower_age</span>, <span class="va">country</span>, <span class="va">year</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    population <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">population</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'new_lower_age', 'country'. You can</span></span>
<span><span class="co">#&gt; override using the `.groups` argument.</span></span>
<span><span class="va">germany_2015</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/age_population.html">age_population</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">world_data</span>,</span>
<span>  location_col <span class="op">=</span> <span class="va">country</span>,</span>
<span>  location <span class="op">=</span> <span class="st">"Germany"</span>,</span>
<span>  age_col <span class="op">=</span> <span class="va">new_lower_age</span>,</span>
<span>  year_col <span class="op">=</span> <span class="va">year</span>,</span>
<span>  year <span class="op">=</span> <span class="fl">2015</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">germany_2015</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 16 × 6</span> <span style="color: #BB0000;">(conmat_population)</span></span></span>
<span><span class="co">#&gt;  <span style="color: #555555;">- age: </span><span style="color: #555555; font-weight: bold;">lower.age.limit</span></span></span>
<span><span class="co">#&gt;  <span style="color: #555555;">- population: </span><span style="color: #555555; font-weight: bold;">population</span></span></span>
<span><span class="co">#&gt;    new_lower_age country  year population lower.age.limit upper.age.limit</span></span>
<span><span class="co">#&gt;            <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>             0 Germany  <span style="text-decoration: underline;">2</span>015    3<span style="text-decoration: underline;">517</span>800               0               4</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>             5 Germany  <span style="text-decoration: underline;">2</span>015    3<span style="text-decoration: underline;">507</span>779               5               9</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>            10 Germany  <span style="text-decoration: underline;">2</span>015    3<span style="text-decoration: underline;">693</span>474              10              14</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>            15 Germany  <span style="text-decoration: underline;">2</span>015    4<span style="text-decoration: underline;">101</span>901              15              19</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>            20 Germany  <span style="text-decoration: underline;">2</span>015    4<span style="text-decoration: underline;">571</span>184              20              24</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>            25 Germany  <span style="text-decoration: underline;">2</span>015    5<span style="text-decoration: underline;">213</span>301              25              29</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>            30 Germany  <span style="text-decoration: underline;">2</span>015    5<span style="text-decoration: underline;">058</span>402              30              34</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>            35 Germany  <span style="text-decoration: underline;">2</span>015    4<span style="text-decoration: underline;">782</span>027              35              39</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>            40 Germany  <span style="text-decoration: underline;">2</span>015    5<span style="text-decoration: underline;">190</span>881              40              44</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>            45 Germany  <span style="text-decoration: underline;">2</span>015    6<span style="text-decoration: underline;">805</span>444              45              49</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span>            50 Germany  <span style="text-decoration: underline;">2</span>015    6<span style="text-decoration: underline;">920</span>702              50              54</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span>            55 Germany  <span style="text-decoration: underline;">2</span>015    5<span style="text-decoration: underline;">998</span>415              55              59</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span>            60 Germany  <span style="text-decoration: underline;">2</span>015    5<span style="text-decoration: underline;">091</span>795              60              64</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span>            65 Germany  <span style="text-decoration: underline;">2</span>015    4<span style="text-decoration: underline;">216</span>896              65              69</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span>            70 Germany  <span style="text-decoration: underline;">2</span>015    4<span style="text-decoration: underline;">225</span>748              70              74</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span>            75 Germany  <span style="text-decoration: underline;">2</span>015    8<span style="text-decoration: underline;">812</span>050              75              79</span></span></code></pre></div>
<p>Now let’s construct a non-homogenous contact matrix, and transmission
probability matrix from the data we have on Germany.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">age_breaks_socialmixr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">75</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span></span>
<span><span class="va">germany_contacts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrapolate_polymod.html">extrapolate_polymod</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">germany_2015</span>,</span>
<span>  age_breaks <span class="op">=</span> <span class="va">age_breaks_socialmixr</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">n_finite_states</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">age_breaks_socialmixr</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1</span></span>
<span><span class="va">socialmixr_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0.1761765</span>,</span>
<span>  nrow <span class="op">=</span> <span class="va">n_finite_states</span>,</span>
<span>  ncol <span class="op">=</span> <span class="va">n_finite_states</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">transmission_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/transmission_probability_matrix.html">transmission_probability_matrix</a></span><span class="op">(</span></span>
<span>  home <span class="op">=</span> <span class="va">socialmixr_matrix</span>,</span>
<span>  work <span class="op">=</span> <span class="va">socialmixr_matrix</span>,</span>
<span>  school <span class="op">=</span> <span class="va">socialmixr_matrix</span>,</span>
<span>  other <span class="op">=</span> <span class="va">socialmixr_matrix</span>,</span>
<span>  age_breaks <span class="op">=</span> <span class="va">age_breaks_socialmixr</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">parameters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"transmission_matrix"</span> <span class="op">=</span> <span class="va">transmission_matrix</span>,</span>
<span>  <span class="st">"homogeneous_contact"</span> <span class="op">=</span> <span class="va">germany_contacts</span>,</span>
<span>  <span class="st">"gamma"</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="st">"s_indexes"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_finite_states</span>,</span>
<span>  <span class="st">"i_indexes"</span> <span class="op">=</span> <span class="op">(</span><span class="va">n_finite_states</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n_finite_states</span><span class="op">)</span>,</span>
<span>  <span class="st">"r_indexes"</span> <span class="op">=</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n_finite_states</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fl">3</span> <span class="op">*</span> <span class="va">n_finite_states</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">S0</span> <span class="op">&lt;-</span> <span class="va">germany_2015</span><span class="op">$</span><span class="va">population</span></span>
<span><span class="va">I0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, times <span class="op">=</span> <span class="va">n_finite_states</span><span class="op">)</span></span>
<span><span class="va">R0</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, times <span class="op">=</span> <span class="va">n_finite_states</span><span class="op">)</span></span>
<span><span class="va">initial_condition</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">S0</span>, <span class="va">I0</span>, <span class="va">R0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">initial_condition</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S0"</span>, <span class="st">"I0"</span>, <span class="st">"R0"</span><span class="op">)</span>, each <span class="op">=</span> <span class="va">n_finite_states</span><span class="op">)</span>,</span>
<span>  <span class="va">age_breaks_socialmixr</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">n_finite_states</span><span class="op">]</span>,</span>
<span>  sep <span class="op">=</span> <span class="st">"_"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Then, similar to above, we solve the ODE</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">times</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="va">germany_soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">initial_condition</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  func <span class="op">=</span> <span class="va">age_structured_sir</span>,</span>
<span>  parms <span class="op">=</span> <span class="va">parameters</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Have to convert ode output to a data frame to do any plotting</span></span>
<span><span class="va">germany_soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">germany_soln</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">germany_soln</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 49</span></span></span>
<span><span class="co">#&gt;    time     S0_0    S0_5  S0_10  S0_15  S0_20  S0_25  S0_30  S0_35  S0_40  S0_45</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   0   3<span style="text-decoration: underline;">517</span>800   3.51<span style="color: #949494;">e</span>6 3.69<span style="color: #949494;">e</span>6 4.10<span style="color: #949494;">e</span>6 4.57<span style="color: #949494;">e</span>6 5.21<span style="color: #949494;">e</span>6 5.06<span style="color: #949494;">e</span>6 4.78<span style="color: #949494;">e</span>6 5.19<span style="color: #949494;">e</span>6 6.81<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   0.1 3<span style="text-decoration: underline;">517</span>800.  3.51<span style="color: #949494;">e</span>6 3.69<span style="color: #949494;">e</span>6 4.10<span style="color: #949494;">e</span>6 4.57<span style="color: #949494;">e</span>6 5.21<span style="color: #949494;">e</span>6 5.06<span style="color: #949494;">e</span>6 4.78<span style="color: #949494;">e</span>6 5.19<span style="color: #949494;">e</span>6 6.81<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   0.2 3<span style="text-decoration: underline;">517</span>800.  3.51<span style="color: #949494;">e</span>6 3.69<span style="color: #949494;">e</span>6 4.10<span style="color: #949494;">e</span>6 4.57<span style="color: #949494;">e</span>6 5.21<span style="color: #949494;">e</span>6 5.06<span style="color: #949494;">e</span>6 4.78<span style="color: #949494;">e</span>6 5.19<span style="color: #949494;">e</span>6 6.81<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   0.3 3<span style="text-decoration: underline;">517</span>800.  3.51<span style="color: #949494;">e</span>6 3.69<span style="color: #949494;">e</span>6 4.10<span style="color: #949494;">e</span>6 4.57<span style="color: #949494;">e</span>6 5.21<span style="color: #949494;">e</span>6 5.06<span style="color: #949494;">e</span>6 4.78<span style="color: #949494;">e</span>6 5.19<span style="color: #949494;">e</span>6 6.81<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   0.4 3<span style="text-decoration: underline;">517</span>799.  3.51<span style="color: #949494;">e</span>6 3.69<span style="color: #949494;">e</span>6 4.10<span style="color: #949494;">e</span>6 4.57<span style="color: #949494;">e</span>6 5.21<span style="color: #949494;">e</span>6 5.06<span style="color: #949494;">e</span>6 4.78<span style="color: #949494;">e</span>6 5.19<span style="color: #949494;">e</span>6 6.81<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   0.5 3<span style="text-decoration: underline;">517</span>799.  3.51<span style="color: #949494;">e</span>6 3.69<span style="color: #949494;">e</span>6 4.10<span style="color: #949494;">e</span>6 4.57<span style="color: #949494;">e</span>6 5.21<span style="color: #949494;">e</span>6 5.06<span style="color: #949494;">e</span>6 4.78<span style="color: #949494;">e</span>6 5.19<span style="color: #949494;">e</span>6 6.81<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 38 more variables: S0_50 &lt;dbl&gt;, S0_55 &lt;dbl&gt;, S0_60 &lt;dbl&gt;, S0_65 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   S0_70 &lt;dbl&gt;, S0_75 &lt;dbl&gt;, I0_0 &lt;dbl&gt;, I0_5 &lt;dbl&gt;, I0_10 &lt;dbl&gt;, I0_15 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   I0_20 &lt;dbl&gt;, I0_25 &lt;dbl&gt;, I0_30 &lt;dbl&gt;, I0_35 &lt;dbl&gt;, I0_40 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   I0_45 &lt;dbl&gt;, I0_50 &lt;dbl&gt;, I0_55 &lt;dbl&gt;, I0_60 &lt;dbl&gt;, I0_65 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   I0_70 &lt;dbl&gt;, I0_75 &lt;dbl&gt;, R0_0 &lt;dbl&gt;, R0_5 &lt;dbl&gt;, R0_10 &lt;dbl&gt;, R0_15 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   R0_20 &lt;dbl&gt;, R0_25 &lt;dbl&gt;, R0_30 &lt;dbl&gt;, R0_35 &lt;dbl&gt;, R0_40 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   R0_45 &lt;dbl&gt;, R0_50 &lt;dbl&gt;, R0_55 &lt;dbl&gt;, R0_60 &lt;dbl&gt;, R0_65 &lt;dbl&gt;, …</span></span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">germany_soln</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 49</span></span></span>
<span><span class="co">#&gt;    time     S0_0    S0_5  S0_10  S0_15  S0_20  S0_25  S0_30  S0_35  S0_40  S0_45</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  99.5 1<span style="text-decoration: underline;">103</span>717. <span style="text-decoration: underline;">463</span>182. 2.46<span style="color: #949494;">e</span>5 2.79<span style="color: #949494;">e</span>5 5.09<span style="color: #949494;">e</span>5 4.81<span style="color: #949494;">e</span>5 4.57<span style="color: #949494;">e</span>5 4.64<span style="color: #949494;">e</span>5 4.75<span style="color: #949494;">e</span>5 4.60<span style="color: #949494;">e</span>5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  99.6 1<span style="text-decoration: underline;">103</span>717. <span style="text-decoration: underline;">463</span>182. 2.46<span style="color: #949494;">e</span>5 2.79<span style="color: #949494;">e</span>5 5.09<span style="color: #949494;">e</span>5 4.81<span style="color: #949494;">e</span>5 4.57<span style="color: #949494;">e</span>5 4.64<span style="color: #949494;">e</span>5 4.75<span style="color: #949494;">e</span>5 4.60<span style="color: #949494;">e</span>5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  99.7 1<span style="text-decoration: underline;">103</span>717. <span style="text-decoration: underline;">463</span>182. 2.46<span style="color: #949494;">e</span>5 2.79<span style="color: #949494;">e</span>5 5.09<span style="color: #949494;">e</span>5 4.81<span style="color: #949494;">e</span>5 4.57<span style="color: #949494;">e</span>5 4.64<span style="color: #949494;">e</span>5 4.75<span style="color: #949494;">e</span>5 4.60<span style="color: #949494;">e</span>5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  99.8 1<span style="text-decoration: underline;">103</span>717. <span style="text-decoration: underline;">463</span>182. 2.46<span style="color: #949494;">e</span>5 2.79<span style="color: #949494;">e</span>5 5.09<span style="color: #949494;">e</span>5 4.81<span style="color: #949494;">e</span>5 4.57<span style="color: #949494;">e</span>5 4.64<span style="color: #949494;">e</span>5 4.75<span style="color: #949494;">e</span>5 4.60<span style="color: #949494;">e</span>5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  99.9 1<span style="text-decoration: underline;">103</span>717. <span style="text-decoration: underline;">463</span>182. 2.46<span style="color: #949494;">e</span>5 2.79<span style="color: #949494;">e</span>5 5.09<span style="color: #949494;">e</span>5 4.81<span style="color: #949494;">e</span>5 4.57<span style="color: #949494;">e</span>5 4.64<span style="color: #949494;">e</span>5 4.75<span style="color: #949494;">e</span>5 4.60<span style="color: #949494;">e</span>5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 100   1<span style="text-decoration: underline;">103</span>717. <span style="text-decoration: underline;">463</span>182. 2.46<span style="color: #949494;">e</span>5 2.79<span style="color: #949494;">e</span>5 5.09<span style="color: #949494;">e</span>5 4.81<span style="color: #949494;">e</span>5 4.57<span style="color: #949494;">e</span>5 4.64<span style="color: #949494;">e</span>5 4.75<span style="color: #949494;">e</span>5 4.60<span style="color: #949494;">e</span>5</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 38 more variables: S0_50 &lt;dbl&gt;, S0_55 &lt;dbl&gt;, S0_60 &lt;dbl&gt;, S0_65 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   S0_70 &lt;dbl&gt;, S0_75 &lt;dbl&gt;, I0_0 &lt;dbl&gt;, I0_5 &lt;dbl&gt;, I0_10 &lt;dbl&gt;, I0_15 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   I0_20 &lt;dbl&gt;, I0_25 &lt;dbl&gt;, I0_30 &lt;dbl&gt;, I0_35 &lt;dbl&gt;, I0_40 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   I0_45 &lt;dbl&gt;, I0_50 &lt;dbl&gt;, I0_55 &lt;dbl&gt;, I0_60 &lt;dbl&gt;, I0_65 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   I0_70 &lt;dbl&gt;, I0_75 &lt;dbl&gt;, R0_0 &lt;dbl&gt;, R0_5 &lt;dbl&gt;, R0_10 &lt;dbl&gt;, R0_15 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   R0_20 &lt;dbl&gt;, R0_25 &lt;dbl&gt;, R0_30 &lt;dbl&gt;, R0_35 &lt;dbl&gt;, R0_40 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   R0_45 &lt;dbl&gt;, R0_50 &lt;dbl&gt;, R0_55 &lt;dbl&gt;, R0_60 &lt;dbl&gt;, R0_65 &lt;dbl&gt;, …</span></span></span>
<span></span>
<span><span class="va">germany_soln_long</span> <span class="op">&lt;-</span> <span class="va">germany_soln</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">tidy_ode</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"age_structured"</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'time'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="va">germany_soln_long</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,003 × 4</span></span></span>
<span><span class="co">#&gt;     time name        value type          </span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>   0   I           16    age_structured</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>   0   R            0    age_structured</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>   0   S     81<span style="text-decoration: underline;">707</span>799    age_structured</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>   0.1 I           18.5  age_structured</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>   0.1 R            1.72 age_structured</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>   0.1 S     81<span style="text-decoration: underline;">707</span>795.   age_structured</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>   0.2 I           21.5  age_structured</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>   0.2 R            3.72 age_structured</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>   0.2 S     81<span style="text-decoration: underline;">707</span>790.   age_structured</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>   0.3 I           24.9  age_structured</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 2,993 more rows</span></span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_germany_sir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>  <span class="va">germany_soln_long</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">initial_condition</span><span class="op">)</span>, colour <span class="op">=</span> <span class="va">name</span><span class="op">)</span></span>
<span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Proportion"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_germany_sir</span></span></code></pre></div>
<p><img src="sir-model_files/figure-html/germany-sir-plot-1.png" width="700"></p>
<p>Let’s compare to the Prem matrices. Prem only has 16 age classes so
we do need to re-do our population.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># NOTE - consider ways to present this data nicer</span></span>
<span><span class="co"># str(prem_germany_contact_matrices)</span></span>
<span><span class="fu"><a href="../reference/as_setting_prediction_matrix.html">as_setting_prediction_matrix</a></span><span class="op">(</span></span>
<span>  <span class="va">prem_germany_contact_matrices</span>,</span>
<span>  age_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">80</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Setting Prediction Matrices</span> <span style="color: #00BBBB;">─────────────────────────────────────────────────</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">A list of matrices containing the model predicted contact rate between ages in</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">each setting.</span></span></span>
<span><span class="co">#&gt; <span style="font-style: italic;">There are 16 age breaks, ranging 0-80 years, with a regular 5 year interval</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">home</span>: a 16x16 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">work</span>: a 16x16 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">school</span>: a 16x16 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">other</span>: a 16x16 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; • <span style="font-weight: bold;">all</span>: a 16x16 <span style="color: #0000BB;">&lt;matrix&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Access each <span style="color: #0000BB;">&lt;matrix&gt;</span> with `x$name`</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> e.g., `x$home`</span></span></code></pre></div>
<p>So we go through a similar process, setting up parameters, and
solving the ODE</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">parameters_prem</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"transmission_matrix"</span> <span class="op">=</span> <span class="va">transmission_matrix</span>,</span>
<span>  <span class="st">"homogeneous_contact"</span> <span class="op">=</span> <span class="va">prem_germany_contact_matrices</span>,</span>
<span>  <span class="st">"gamma"</span> <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  <span class="st">"s_indexes"</span> <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="va">n_finite_states</span>,</span>
<span>  <span class="st">"i_indexes"</span> <span class="op">=</span> <span class="op">(</span><span class="va">n_finite_states</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n_finite_states</span><span class="op">)</span>,</span>
<span>  <span class="st">"r_indexes"</span> <span class="op">=</span> <span class="op">(</span><span class="fl">2</span> <span class="op">*</span> <span class="va">n_finite_states</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">:</span><span class="op">(</span><span class="fl">3</span> <span class="op">*</span> <span class="va">n_finite_states</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">prem_soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">initial_condition</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  func <span class="op">=</span> <span class="va">age_structured_sir</span>,</span>
<span>  parms <span class="op">=</span> <span class="va">parameters_prem</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Have to convert ode output to a data frame to do any plotting</span></span>
<span><span class="va">prem_soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">prem_soln</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">prem_soln</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 49</span></span></span>
<span><span class="co">#&gt;    time     S0_0    S0_5  S0_10  S0_15  S0_20  S0_25  S0_30  S0_35  S0_40  S0_45</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>  99.5 2<span style="text-decoration: underline;">757</span>450.  2.53<span style="color: #949494;">e</span>6 1.86<span style="color: #949494;">e</span>6 1.01<span style="color: #949494;">e</span>6 1.79<span style="color: #949494;">e</span>6 2.64<span style="color: #949494;">e</span>6 2.48<span style="color: #949494;">e</span>6 1.84<span style="color: #949494;">e</span>6 1.87<span style="color: #949494;">e</span>6 3.01<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>  99.6 2<span style="text-decoration: underline;">757</span>450.  2.53<span style="color: #949494;">e</span>6 1.86<span style="color: #949494;">e</span>6 1.01<span style="color: #949494;">e</span>6 1.79<span style="color: #949494;">e</span>6 2.64<span style="color: #949494;">e</span>6 2.48<span style="color: #949494;">e</span>6 1.84<span style="color: #949494;">e</span>6 1.87<span style="color: #949494;">e</span>6 3.01<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>  99.7 2<span style="text-decoration: underline;">757</span>450.  2.53<span style="color: #949494;">e</span>6 1.86<span style="color: #949494;">e</span>6 1.01<span style="color: #949494;">e</span>6 1.79<span style="color: #949494;">e</span>6 2.64<span style="color: #949494;">e</span>6 2.48<span style="color: #949494;">e</span>6 1.84<span style="color: #949494;">e</span>6 1.87<span style="color: #949494;">e</span>6 3.01<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>  99.8 2<span style="text-decoration: underline;">757</span>450.  2.53<span style="color: #949494;">e</span>6 1.86<span style="color: #949494;">e</span>6 1.01<span style="color: #949494;">e</span>6 1.79<span style="color: #949494;">e</span>6 2.64<span style="color: #949494;">e</span>6 2.48<span style="color: #949494;">e</span>6 1.84<span style="color: #949494;">e</span>6 1.87<span style="color: #949494;">e</span>6 3.01<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>  99.9 2<span style="text-decoration: underline;">757</span>450.  2.53<span style="color: #949494;">e</span>6 1.86<span style="color: #949494;">e</span>6 1.01<span style="color: #949494;">e</span>6 1.79<span style="color: #949494;">e</span>6 2.64<span style="color: #949494;">e</span>6 2.48<span style="color: #949494;">e</span>6 1.84<span style="color: #949494;">e</span>6 1.87<span style="color: #949494;">e</span>6 3.01<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 100   2<span style="text-decoration: underline;">757</span>450.  2.53<span style="color: #949494;">e</span>6 1.86<span style="color: #949494;">e</span>6 1.01<span style="color: #949494;">e</span>6 1.79<span style="color: #949494;">e</span>6 2.64<span style="color: #949494;">e</span>6 2.48<span style="color: #949494;">e</span>6 1.84<span style="color: #949494;">e</span>6 1.87<span style="color: #949494;">e</span>6 3.01<span style="color: #949494;">e</span>6</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 38 more variables: S0_50 &lt;dbl&gt;, S0_55 &lt;dbl&gt;, S0_60 &lt;dbl&gt;, S0_65 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   S0_70 &lt;dbl&gt;, S0_75 &lt;dbl&gt;, I0_0 &lt;dbl&gt;, I0_5 &lt;dbl&gt;, I0_10 &lt;dbl&gt;, I0_15 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   I0_20 &lt;dbl&gt;, I0_25 &lt;dbl&gt;, I0_30 &lt;dbl&gt;, I0_35 &lt;dbl&gt;, I0_40 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   I0_45 &lt;dbl&gt;, I0_50 &lt;dbl&gt;, I0_55 &lt;dbl&gt;, I0_60 &lt;dbl&gt;, I0_65 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   I0_70 &lt;dbl&gt;, I0_75 &lt;dbl&gt;, R0_0 &lt;dbl&gt;, R0_5 &lt;dbl&gt;, R0_10 &lt;dbl&gt;, R0_15 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   R0_20 &lt;dbl&gt;, R0_25 &lt;dbl&gt;, R0_30 &lt;dbl&gt;, R0_35 &lt;dbl&gt;, R0_40 &lt;dbl&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   R0_45 &lt;dbl&gt;, R0_50 &lt;dbl&gt;, R0_55 &lt;dbl&gt;, R0_60 &lt;dbl&gt;, R0_65 &lt;dbl&gt;, …</span></span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">germany_aggregated</span> <span class="op">&lt;-</span> <span class="fu">tidy_ode</span><span class="op">(</span><span class="va">germany_soln</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'time'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="co"># For the stratified model, we have to add up all the age categories together for a fair comparison.</span></span>
<span><span class="va">prem_aggregated</span> <span class="op">&lt;-</span> <span class="fu">tidy_ode</span><span class="op">(</span><span class="va">prem_soln</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'time'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="va">conmat_prem_soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  conmat <span class="op">=</span> <span class="va">germany_aggregated</span>,</span>
<span>  prem <span class="op">=</span> <span class="va">prem_aggregated</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"type"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">conmat_prem_soln</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   type    time name        value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> conmat   0   I           16   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> conmat   0   R            0   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> conmat   0   S     81<span style="text-decoration: underline;">707</span>799   </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> conmat   0.1 I           18.5 </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> conmat   0.1 R            1.72</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> conmat   0.1 S     81<span style="text-decoration: underline;">707</span>795.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">tail</a></span><span class="op">(</span><span class="va">conmat_prem_soln</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 4</span></span></span>
<span><span class="co">#&gt;   type   time name    value</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> prem   99.9 I     2.82<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> prem   99.9 R     3.15<span style="color: #949494;">e</span>+7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> prem   99.9 S     5.02<span style="color: #949494;">e</span>+7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> prem  100   I     2.73<span style="color: #949494;">e</span><span style="color: #BB0000;">-4</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> prem  100   R     3.15<span style="color: #949494;">e</span>+7</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> prem  100   S     5.02<span style="color: #949494;">e</span>+7</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">conmat_prem_soln</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Value"</span>, colour <span class="op">=</span> <span class="st">"Model"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">name</span>, nrow <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p><img src="sir-model_files/figure-html/plot-conmat-prem-1.png" width="700"></p>
<p>These are really different, but we have to be careful about why. The
contact matrices might refer to the same quantity, but if we dive a
little deeper, we find out that might not be the case…</p>
<div class="section level3">
<h3 id="calculating-reproductive-number---r0">Calculating reproductive number - R0<a class="anchor" aria-label="anchor" href="#calculating-reproductive-number---r0"></a>
</h3>
<p>To fairly compare a dynamic disease model that differs <em>only</em>
by it’s contact matrices, it’s important to remember that the <span class="math inline">\((i,j)\)</span>th element of one of these matrices
is the <em>relative</em> number of contacts between individuals of age
<span class="math inline">\(i\)</span> and age <span class="math inline">\(j\)</span>. But, what the number is relative to
might be different, and this will lead to different basic reproduction
numbers, which will give misleading model conclusions.</p>
<p>At this point, it is important to point out the two definitions of a
next generation matrix.</p>
<ol style="list-style-type: decimal">
<li>The next generation of the offspring distribution assuming infinite
lifetime, which probabilists will be used to, and</li>
<li>The number of newly infected individuals over the course of one
generation of infections, which infectious diseases modellers will be
used to.</li>
</ol>
<p><code>conmat</code> calculates the first of these in it’s functions
(such as <code>generate_ngm</code>), hence why the arguments to these
functions have no concept of an infectious period (which is analogous to
‘death’ in a branching process).</p>
<p>Following the approach of Diekmann, Heesterbrook and Roberts (2009),
one can think of the NGM generated by <code>conmat</code> as only the
transmissions term of Equation 2.9. So, to ensure both models have the
same value of <span class="math inline">\(R_0\)</span>, we can multiply
each matrix by a scaling factor to give a target <span class="math inline">\(R_0\)</span>.</p>
<p>To target <span class="math inline">\(R_0=1.5\)</span> for
example,</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">calculate_R0</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">multiplier</span>, <span class="va">transmission_matrices</span>, <span class="va">contact_matrices</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">total_matrix</span> <span class="op">&lt;-</span> <span class="va">transmission_matrices</span><span class="op">$</span><span class="va">home</span> <span class="op">*</span> <span class="va">contact_matrices</span><span class="op">$</span><span class="va">home</span> <span class="op">+</span></span>
<span>    <span class="va">transmission_matrices</span><span class="op">$</span><span class="va">work</span> <span class="op">*</span> <span class="va">contact_matrices</span><span class="op">$</span><span class="va">work</span> <span class="op">+</span></span>
<span>    <span class="va">transmission_matrices</span><span class="op">$</span><span class="va">school</span> <span class="op">*</span> <span class="va">contact_matrices</span><span class="op">$</span><span class="va">school</span> <span class="op">+</span></span>
<span>    <span class="va">transmission_matrices</span><span class="op">$</span><span class="va">other</span> <span class="op">*</span> <span class="va">contact_matrices</span><span class="op">$</span><span class="va">other</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/complex.html" class="external-link">Re</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/eigen.html" class="external-link">eigen</a></span><span class="op">(</span><span class="va">total_matrix</span> <span class="op">*</span> <span class="va">multiplier</span><span class="op">)</span><span class="op">$</span><span class="va">values</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op">-</span> <span class="fl">1.5</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">scaling_factor</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/optimize.html" class="external-link">optimize</a></span><span class="op">(</span></span>
<span>    f <span class="op">=</span> <span class="va">calculate_R0</span>,</span>
<span>    interval <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.001</span>, <span class="fl">5</span><span class="op">)</span>,</span>
<span>    transmission_matrices <span class="op">=</span> <span class="va">transmission_matrix</span>,</span>
<span>    contact_matrices <span class="op">=</span> <span class="va">contact_matrix</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">scaling_factor_prem</span> <span class="op">&lt;-</span> <span class="fu">scaling_factor</span><span class="op">(</span><span class="va">prem_germany_contact_matrices</span><span class="op">)</span></span>
<span><span class="va">scaling_factor_socialmixr</span> <span class="op">&lt;-</span> <span class="fu">scaling_factor</span><span class="op">(</span><span class="va">germany_contacts</span><span class="op">)</span></span>
<span></span>
<span><span class="va">scaling_factor_prem</span><span class="op">$</span><span class="va">minimum</span></span>
<span><span class="co">#&gt; [1] 0.9999758</span></span>
<span><span class="va">scaling_factor_socialmixr</span><span class="op">$</span><span class="va">minimum</span></span>
<span><span class="co">#&gt; [1] 0.5819233</span></span></code></pre></div>
<p>We can adjust our contact matrices with these factors, and then our
R0s will be the same, meaning that the only difference between the two
models should be differences in the contact matrices.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prem_germany_contact_matrices</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">prem_germany_contact_matrices</span>, <span class="va">`*`</span>, <span class="va">scaling_factor_prem</span><span class="op">$</span><span class="va">minimum</span><span class="op">)</span></span>
<span><span class="va">germany_contacts</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">germany_contacts</span>, <span class="va">`*`</span>, <span class="va">scaling_factor_socialmixr</span><span class="op">$</span><span class="va">minimum</span><span class="op">)</span></span>
<span></span>
<span><span class="va">parameters</span><span class="op">$</span><span class="va">homogeneous_contact</span> <span class="op">&lt;-</span> <span class="va">germany_contacts</span></span>
<span><span class="va">germany_soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">initial_condition</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  func <span class="op">=</span> <span class="va">age_structured_sir</span>,</span>
<span>  parms <span class="op">=</span> <span class="va">parameters</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">parameters</span><span class="op">$</span><span class="va">homogeneous_contact</span> <span class="op">&lt;-</span> <span class="va">prem_germany_contact_matrices</span></span>
<span><span class="va">prem_soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/deSolve/man/ode.html" class="external-link">ode</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">initial_condition</span>,</span>
<span>  times <span class="op">=</span> <span class="va">times</span>,</span>
<span>  func <span class="op">=</span> <span class="va">age_structured_sir</span>,</span>
<span>  parms <span class="op">=</span> <span class="va">parameters</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">germany_aggregated</span> <span class="op">&lt;-</span> <span class="fu">tidy_ode</span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">germany_soln</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'time'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span><span class="va">prem_aggregated</span> <span class="op">&lt;-</span> <span class="fu">tidy_ode</span><span class="op">(</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">prem_soln</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; `summarise()` has grouped output by 'time'. You can override using the</span></span>
<span><span class="co">#&gt; `.groups` argument.</span></span>
<span></span>
<span><span class="va">conmat_prem_soln</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind_rows.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  conmat <span class="op">=</span> <span class="va">germany_aggregated</span>,</span>
<span>  prem <span class="op">=</span> <span class="va">prem_aggregated</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"type"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">name</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"S"</span>, <span class="st">"I"</span>, <span class="st">"R"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'scales'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:purrr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     discard</span></span>
<span><span class="va">conmat_prem_soln</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">time</span> <span class="op">&lt;=</span> <span class="fl">50</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">value</span>, colour <span class="op">=</span> <span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span><span class="op">~</span><span class="va">name</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    scales <span class="op">=</span> <span class="st">"free_y"</span>,</span>
<span>    labeller <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labeller.html" class="external-link">labeller</a></span><span class="op">(</span></span>
<span>      name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        S <span class="op">=</span> <span class="st">"Susceptible"</span>,</span>
<span>        I <span class="op">=</span> <span class="st">"Infected"</span>,</span>
<span>        R <span class="op">=</span> <span class="st">"Recovered"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/label_number.html" class="external-link">label_number</a></span><span class="op">(</span>scale_cut <span class="op">=</span> <span class="fu"><a href="https://scales.r-lib.org/reference/number.html" class="external-link">cut_si</a></span><span class="op">(</span><span class="st">""</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    n.breaks <span class="op">=</span> <span class="fl">3</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_colour_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Dark2"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Time"</span>, y <span class="op">=</span> <span class="st">"Population"</span>, colour <span class="op">=</span> <span class="st">"Model"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="sir-model_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>So now we have as fair of a comparison of the two matrices as we will
get, and yet, there are significant differences in the dynamics of the
two models.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Nicholas Tierney, <a href="https://www.telethonkids.org.au/contact-us/our-people/g/nick-golding/" class="external-link">Nick Golding</a>, <a href="https://aarathybabu.netlify.app/" class="external-link">Aarathy Babu</a>, Michael Lydeamore.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
