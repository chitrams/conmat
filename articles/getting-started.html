<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Getting Started • conmat</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Getting Started">
<meta property="og:description" content="conmat">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">conmat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.0.0.9004</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/getting-started.html">Getting Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">News</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Getting Started</h1>
            
      
      
      <div class="hidden name"><code>getting-started.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">conmat</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'socialmixr'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     cite</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">mgcv</span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required package: nlme</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'nlme'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:dplyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     collapse</span></span>
<span><span class="co">#&gt; This is mgcv 1.8-41. For overview type 'help("mgcv-package")'.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<p>The goal of conmat is to make it easy to generate synthetic contact
matrices for a given age population.</p>
<p><strong>What is a contact matrix?</strong></p>
<p>Contact matrices describe the degree of contact between individuals
of given age groups.</p>
<p>For example, this matrix describes the number of contacts between
individuals</p>
<pre><code><span><span class="co">#&gt;       0-4 5-9 10-14</span></span>
<span><span class="co">#&gt; 0-4    10   3     4</span></span>
<span><span class="co">#&gt; 5-9     3  11     5</span></span>
<span><span class="co">#&gt; 10-14   4   5    13</span></span></code></pre>
<p>The rows and columns represent the age groups of the people. On the
main diagonal we see that we have a higher number of contacts - showing
that people of similar ages tend to interact more with one another.</p>
<p>We can use the information in these matrices to model how diseases
such as COVID-19 spread in a population through social contact.</p>
<p><strong>Why do we need <em>synthetic</em> contact
matrices?</strong></p>
<p>Contact matrices are produced from empirical data resulting from a
contact survey, which requires individuals to diary the amount and
manner of contact a person has in a day.</p>
<p>However, these surveys are highly time-consuming and expensive to
run, meaning that only a handful of these empirical datasets exist
globally.</p>
<p>We can use statistical methods to create <em>synthetic contact
matrices</em>, which are new contact matrices that have been generalised
to new countries based on existing surveys.</p>
<p><strong>Why do we need <code>conmat</code>?</strong></p>
<p>Existing methods only provide outputs of the contact matrices for
each country, or at best, for urban and rural areas for a given
country.</p>
<p>We need methods that allow for flexibly creating synthetic contact
matrices for a specified age population, as the age population
distribution of many countries (e.g., Australia), are quite
heterogeneous, and assuming it is homogeneous would result in inaccurate
representation of community infection in many regions.</p>
<div class="section level2">
<h2 id="example">Example<a class="anchor" aria-label="anchor" href="#example"></a>
</h2>
<p>First we want to fit the model to the POLYMOD data, which contains
various survey and population data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">conmat</span><span class="op">)</span></span>
<span><span class="va">polymod_contact_data_home</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_polymod_contact_data.html">get_polymod_contact_data</a></span><span class="op">(</span>setting <span class="op">=</span> <span class="st">"home"</span><span class="op">)</span></span>
<span><span class="va">polymod_survey_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_polymod_population.html">get_polymod_population</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>The contact data is a data frame containing the age from and to, and
the number of contacts for each of the specified settings, “home”,
“work”, “school”, “other”, or “all” as well as the number of
participants. By default, <code>polymod_contact_data</code> contains
data from “all”, but we’re going to use the “work” set of data, as it
produces an interesting looking dataset. Each row contains survey
information of the number of contacts. Specifically, the number of
contacts from one age group to another age group, and then the number of
participants in that age group.</p>
<p>The survey data, <code>polymod_survey_data</code> contains the lower
age limit and the population in that age group.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polymod_survey_data</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 21 × 2</span></span></span>
<span><span class="co">#&gt;    lower.age.limit population</span></span>
<span><span class="co">#&gt;              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>               0   1<span style="text-decoration: underline;">852</span>682.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>               5   1<span style="text-decoration: underline;">968</span>449.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>              10   2<span style="text-decoration: underline;">138</span>897.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>              15   2<span style="text-decoration: underline;">312</span>032.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>              20   2<span style="text-decoration: underline;">407</span>486.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>              25   2<span style="text-decoration: underline;">423</span>602.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>              30   2<span style="text-decoration: underline;">585</span>137.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>              35   2<span style="text-decoration: underline;">969</span>393.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>              40   3<span style="text-decoration: underline;">041</span>663.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>              45   2<span style="text-decoration: underline;">809</span>154.</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 11 more rows</span></span></span></code></pre></div>
<p>We also provide control over the POLYMOD data retrieved from
<code><a href="../reference/get_polymod_contact_data.html">get_polymod_contact_data()</a></code> via the arguments,
<code>setting</code>, <code>country</code>, and <code>ages</code>. These
allow you to specify the data to be only from certain settings or
countries or ages. See <code><a href="../reference/get_polymod_contact_data.html">?get_polymod_contact_data</a></code> for more
details. Below is a brief example of this:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polymod_contact_data_belgium_0_10</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_polymod_contact_data.html">get_polymod_contact_data</a></span><span class="op">(</span></span>
<span>  setting <span class="op">=</span> <span class="st">"work"</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"Belgium"</span>,</span>
<span>  ages <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">5</span>,<span class="fl">10</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">polymod_contact_data_belgium_0_10</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 3,434 × 5</span></span></span>
<span><span class="co">#&gt;    setting age_from age_to contacts participants</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> work           0      0        0            5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> work           0      1        0            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> work           0      2        0            2</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> work           0      3        0            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> work           0      4        0            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> work           0      5        0            5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> work           0      7        0            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> work           0     10        0            5</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> work           0     11        0            1</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> work           0     12        0            1</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 3,424 more rows</span></span></span></code></pre></div>
<p>Similarly, you can control the population data, retrieving it only
for certain countries:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_polymod_population.html">get_polymod_population</a></span><span class="op">(</span>countries <span class="op">=</span> <span class="st">"Belgium"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 21 × 2</span></span></span>
<span><span class="co">#&gt;    lower.age.limit population</span></span>
<span><span class="co">#&gt;              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>               0     <span style="text-decoration: underline;">583</span>492</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>               5     <span style="text-decoration: underline;">593</span>148</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>              10     <span style="text-decoration: underline;">632</span>157</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>              15     <span style="text-decoration: underline;">626</span>921</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>              20     <span style="text-decoration: underline;">649</span>588</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>              25     <span style="text-decoration: underline;">663</span>176</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>              30     <span style="text-decoration: underline;">705</span>878</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>              35     <span style="text-decoration: underline;">773</span>177</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>              40     <span style="text-decoration: underline;">823</span>305</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>              45     <span style="text-decoration: underline;">779</span>436</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 11 more rows</span></span></span>
<span><span class="fu"><a href="../reference/get_polymod_population.html">get_polymod_population</a></span><span class="op">(</span>countries <span class="op">=</span> <span class="st">"Finland"</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 21 × 2</span></span></span>
<span><span class="co">#&gt;    lower.age.limit population</span></span>
<span><span class="co">#&gt;              <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span>               0     <span style="text-decoration: underline;">284</span>683</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span>               5     <span style="text-decoration: underline;">296</span>753</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span>              10     <span style="text-decoration: underline;">330</span>425</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span>              15     <span style="text-decoration: underline;">319</span>947</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span>              20     <span style="text-decoration: underline;">334</span>180</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span>              25     <span style="text-decoration: underline;">331</span>510</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span>              30     <span style="text-decoration: underline;">308</span>108</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span>              35     <span style="text-decoration: underline;">352</span>962</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span>              40     <span style="text-decoration: underline;">379</span>090</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span>              45     <span style="text-decoration: underline;">381</span>713</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 11 more rows</span></span></span></code></pre></div>
<p>You can see the available countries in the helpfile with
<code><a href="../reference/get_polymod_population.html">?get_polymod_population</a></code>.</p>
</div>
<div class="section level2">
<h2 id="predicting-the-contact-rate">Predicting the contact rate<a class="anchor" aria-label="anchor" href="#predicting-the-contact-rate"></a>
</h2>
<p>We can create a model of the contact <em>rate</em> with the function
<code>fit_single_contact_model</code>. We’re first going to use some
smaller sets of the data, to save on computation time.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">-</span><span class="fl">10</span><span class="op">-</span><span class="fl">04</span><span class="op">)</span></span>
<span><span class="va">polymod_contact_data_home_small</span> <span class="op">&lt;-</span> <span class="va">polymod_contact_data_home</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age_from</span> <span class="op">&lt;=</span> <span class="fl">30</span>,</span>
<span>         <span class="va">age_to</span> <span class="op">&lt;=</span> <span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="va">polymod_survey_data_small</span> <span class="op">&lt;-</span> <span class="va">polymod_survey_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">lower.age.limit</span> <span class="op">&lt;=</span> <span class="fl">30</span><span class="op">)</span></span>
<span></span>
<span><span class="va">contact_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_single_contact_model.html">fit_single_contact_model</a></span><span class="op">(</span></span>
<span>  contact_data <span class="op">=</span> <span class="va">polymod_contact_data_home_small</span>,</span>
<span>  population <span class="op">=</span> <span class="va">polymod_survey_data_small</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This fits a generalised additive model (GAM), predicting the contact
rate, based on a series of prediction terms that describe various
features of the contact rates.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_model</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: poisson </span></span>
<span><span class="co">#&gt; Link function: log </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; contacts ~ s(gam_age_offdiag) + s(gam_age_offdiag_2) + s(gam_age_diag_prod) + </span></span>
<span><span class="co">#&gt;     s(gam_age_diag_sum) + s(gam_age_pmax) + s(gam_age_pmin) + </span></span>
<span><span class="co">#&gt;     school_probability + work_probability + offset(log_contactable_population)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated degrees of freedom:</span></span>
<span><span class="co">#&gt; 7.10 1.00 4.87 1.00 5.63 4.25  total = 26.86 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; fREML score: 1648.48     rank: 55/57</span></span></code></pre></div>
<p>We can use this contact model to then predict the contact rate in a
new population.</p>
<p>As a demonstration, let’s take an age population from a given LGA in
Australia (this was the initial motivation for the package, so there are
some helper functions for Australian specific data).</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fairfield_age_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/abs_age_data.html">abs_age_lga</a></span><span class="op">(</span><span class="st">"Fairfield (C)"</span><span class="op">)</span></span>
<span><span class="va">fairfield_age_pop</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 18 × 4</span></span></span>
<span><span class="co">#&gt;    lga           lower.age.limit  year population</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> Fairfield (C)               0  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">12</span>261</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> Fairfield (C)               5  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">13</span>093</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> Fairfield (C)              10  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">13</span>602</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> Fairfield (C)              15  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">14</span>323</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> Fairfield (C)              20  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">15</span>932</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> Fairfield (C)              25  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">16</span>190</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> Fairfield (C)              30  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">14</span>134</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> Fairfield (C)              35  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">13</span>034</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> Fairfield (C)              40  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">12</span>217</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> Fairfield (C)              45  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">13</span>449</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">11</span> Fairfield (C)              50  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">13</span>419</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">12</span> Fairfield (C)              55  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">13</span>652</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">13</span> Fairfield (C)              60  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">12</span>907</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">14</span> Fairfield (C)              65  <span style="text-decoration: underline;">2</span>020      <span style="text-decoration: underline;">10</span>541</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">15</span> Fairfield (C)              70  <span style="text-decoration: underline;">2</span>020       <span style="text-decoration: underline;">8</span>227</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">16</span> Fairfield (C)              75  <span style="text-decoration: underline;">2</span>020       <span style="text-decoration: underline;">5</span>598</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">17</span> Fairfield (C)              80  <span style="text-decoration: underline;">2</span>020       <span style="text-decoration: underline;">4</span>006</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">18</span> Fairfield (C)              85  <span style="text-decoration: underline;">2</span>020       <span style="text-decoration: underline;">4</span>240</span></span></code></pre></div>
<p>We can then pass the contact model through to
<code>predict_contacts</code>, along with the fairfield age population
data, and some age breaks that we want to predict to. Note that these
age breaks could be any size, we just ahve them set to 5 year age
brackets in most of the examples, but these could be 1 year, 2 year, or
even sub year.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2022</span><span class="op">-</span><span class="fl">10</span><span class="op">-</span><span class="fl">04</span><span class="op">)</span></span>
<span><span class="va">synthetic_contact_fairfield</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_contacts.html">predict_contacts</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">contact_model</span>,</span>
<span>  population <span class="op">=</span> <span class="va">fairfield_age_pop</span>,</span>
<span>  age_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">30</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">synthetic_contact_fairfield</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 49 × 3</span></span></span>
<span><span class="co">#&gt;    age_group_from age_group_to contacts</span></span>
<span><span class="co">#&gt;    <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>          <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>           <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 1</span> [0,5)          [0,5)        1.80<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 2</span> [0,5)          [5,10)       1.61<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 3</span> [0,5)          [10,15)      8.56<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 4</span> [0,5)          [15,20)      5.65<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 5</span> [0,5)          [20,25)      8.68<span style="color: #949494;">e</span><span style="color: #BB0000;">- 2</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 6</span> [0,5)          [25,30)      1.79<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 7</span> [0,5)          [30,Inf)     5.21<span style="color: #949494;">e</span>+18</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 8</span> [5,10)         [0,5)        1.53<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;"> 9</span> [5,10)         [5,10)       2.51<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">10</span> [5,10)         [10,15)      1.88<span style="color: #949494;">e</span><span style="color: #BB0000;">- 1</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># … with 39 more rows</span></span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plotting">Plotting<a class="anchor" aria-label="anchor" href="#plotting"></a>
</h2>
<p>Let’s visualise the matrix to get a sense of the predictions with
<code>autoplot</code>. First we need to transform the predictions to a
matrix:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">synthetic_contact_fairfield</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="../reference/predictions_to_matrix.html">predictions_to_matrix</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/plot-matrix-differents-1.png" width="700"></p>
</div>
<div class="section level2">
<h2 id="note">Note<a class="anchor" aria-label="anchor" href="#note"></a>
</h2>
<p>It is worth noting that the contact matrices created using this
package are transposed when compared to the contact matrices discussed
by <a href="https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1005697" class="external-link">Prem</a>
and <a href="https://journals.plos.org/plosmedicine/article?id=10.1371/journal.pmed.0050074" class="external-link">Mossong</a>.
That is, the rows are “age group to”, and the columns are “age group
from”.</p>
</div>
<div class="section level2">
<h2 id="applying-the-model-across-all-settings-">Applying the model across all settings.<a class="anchor" aria-label="anchor" href="#applying-the-model-across-all-settings-"></a>
</h2>
<p>Our experience has been that we would be fitting the same models to
each setting when doing data analysis when using conmat. Accordingly,
you can also fit a model for all of the settings all at once with the
functions, <code><a href="../reference/fit_setting_contacts.html">fit_setting_contacts()</a></code>, and
<code><a href="../reference/predict_setting_contacts.html">predict_setting_contacts()</a></code>. This means we can do the above,
but for each setting, “home”, “work”, “school”, “other”, and “all”, at
once. If we want to use all of the POLYMOD data, we can also use the
<code><a href="../reference/extrapolate_polymod.html">extrapolate_polymod()</a></code> function.</p>
<div class="section level3">
<h3 id="fit-to-all-settings">Fit to all settings<a class="anchor" aria-label="anchor" href="#fit-to-all-settings"></a>
</h3>
<p>We can create a model for each of the settings with
<code><a href="../reference/fit_setting_contacts.html">fit_setting_contacts()</a></code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">-</span><span class="fl">09</span><span class="op">-</span><span class="fl">24</span><span class="op">)</span></span>
<span></span>
<span><span class="va">polymod_setting_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_polymod_setting_data.html">get_polymod_setting_data</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">polymod_setting_data_small</span> <span class="op">&lt;-</span> <span class="va">polymod_setting_data</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span>FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="va">x</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">age_from</span> <span class="op">&lt;=</span> <span class="fl">20</span>, <span class="va">age_to</span> <span class="op">&lt;=</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">setting_models</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_setting_contacts.html">fit_setting_contacts</a></span><span class="op">(</span></span>
<span>  contact_data_list <span class="op">=</span> <span class="va">polymod_setting_data_small</span>,</span>
<span>  population <span class="op">=</span> <span class="va">polymod_survey_data</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">#&gt; Warning in bgam.fit(G, mf, chunk.size, gp, scale, gamma, method = method, :</span></span>
<span><span class="co">#&gt; algorithm did not converge</span></span></code></pre></div>
<p>This contains a list of models, one for each setting. We can look at
one, and get summary information out:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">setting_models</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "home"   "work"   "school" "other"</span></span>
<span><span class="va">setting_models</span><span class="op">$</span><span class="va">home</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Family: poisson </span></span>
<span><span class="co">#&gt; Link function: log </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Formula:</span></span>
<span><span class="co">#&gt; contacts ~ s(gam_age_offdiag) + s(gam_age_offdiag_2) + s(gam_age_diag_prod) + </span></span>
<span><span class="co">#&gt;     s(gam_age_diag_sum) + s(gam_age_pmax) + s(gam_age_pmin) + </span></span>
<span><span class="co">#&gt;     school_probability + work_probability + offset(log_contactable_population)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Estimated degrees of freedom:</span></span>
<span><span class="co">#&gt; 6.145 1.000 4.845 1.000 0.687 4.474  total = 21.15 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; fREML score: 785.6112     rank: 55/57</span></span></code></pre></div>
<p>So this gives us our baseline model of a contact model. We have fit
this model to the existing contact survey data. We can now predict to
another age population, to create our “synthetic” contact matrix.</p>
</div>
<div class="section level3">
<h3 id="predict-to-all-settings">Predict to all settings<a class="anchor" aria-label="anchor" href="#predict-to-all-settings"></a>
</h3>
<p>Then we take the model we had earlier, and extrapolate to the
fairfield data with <code>predict_setting_contacts</code>, also
providing some age breaks we want to predict to</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2021</span><span class="op">-</span><span class="fl">10</span><span class="op">-</span><span class="fl">04</span><span class="op">)</span></span>
<span><span class="va">synthetic_settings_5y_fairfield</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_setting_contacts.html">predict_setting_contacts</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">fairfield_age_pop</span>,</span>
<span>  contact_model <span class="op">=</span> <span class="va">setting_models</span>,</span>
<span>  age_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>This then returns a list of synthetic matrices, “home”, “work”,
“school”, “other”, and “all”, which is the sum of all matrices.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">synthetic_settings_5y_fairfield</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 5</span></span>
<span><span class="co">#&gt;  $ home  : 'conmat_prediction_matrix' num [1:5, 1:5] 1.16e-01 1.04e-01 5.73e-02 3.52e-02 2.21e+33 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:5] "[0,5)" "[5,10)" "[10,15)" "[15,20)" ...</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:5] "[0,5)" "[5,10)" "[10,15)" "[15,20)" ...</span></span>
<span><span class="co">#&gt;  $ work  : 'conmat_prediction_matrix' num [1:5, 1:5] 0.000201 0.000192 0.000105 0.002279 0.000203 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:5] "[0,5)" "[5,10)" "[10,15)" "[15,20)" ...</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:5] "[0,5)" "[5,10)" "[10,15)" "[15,20)" ...</span></span>
<span><span class="co">#&gt;  $ school: 'conmat_prediction_matrix' num [1:5, 1:5] 0.77218 0.14825 0.00901 0.00888 Inf ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:5] "[0,5)" "[5,10)" "[10,15)" "[15,20)" ...</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:5] "[0,5)" "[5,10)" "[10,15)" "[15,20)" ...</span></span>
<span><span class="co">#&gt;  $ other : 'conmat_prediction_matrix' num [1:5, 1:5] 1.64e-01 9.85e-02 3.95e-02 2.58e-02 5.24e+41 ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:5] "[0,5)" "[5,10)" "[10,15)" "[15,20)" ...</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:5] "[0,5)" "[5,10)" "[10,15)" "[15,20)" ...</span></span>
<span><span class="co">#&gt;  $ all   : 'conmat_prediction_matrix' num [1:5, 1:5] 1.0518 0.3509 0.1059 0.0721 Inf ...</span></span>
<span><span class="co">#&gt;   ..- attr(*, "dimnames")=List of 2</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:5] "[0,5)" "[5,10)" "[10,15)" "[15,20)" ...</span></span>
<span><span class="co">#&gt;   .. ..$ : chr [1:5] "[0,5)" "[5,10)" "[10,15)" "[15,20)" ...</span></span>
<span><span class="co">#&gt;  - attr(*, "class")= chr [1:2] "conmat_setting_prediction_matrix" "list"</span></span>
<span><span class="va">synthetic_settings_5y_fairfield</span><span class="op">$</span><span class="va">home</span></span>
<span><span class="co">#&gt;                 [0,5)       [5,10)      [10,15)      [15,20)     [20,Inf)</span></span>
<span><span class="co">#&gt; [0,5)    1.155808e-01 9.833518e-02 5.148435e-02 2.960689e-02 1.719021e+32</span></span>
<span><span class="co">#&gt; [5,10)   1.039830e-01 1.571624e-01 1.141579e-01 4.086305e-02 9.175598e+25</span></span>
<span><span class="co">#&gt; [10,15)  5.731958e-02 1.201933e-01 1.887684e-01 9.963227e-02 9.813571e+20</span></span>
<span><span class="co">#&gt; [15,20)  3.517148e-02 4.590661e-02 1.063090e-01 1.658309e-01 2.277138e+16</span></span>
<span><span class="co">#&gt; [20,Inf) 2.210238e+33 1.115678e+27 1.133332e+22 2.464616e+17 4.391374e+12</span></span>
<span><span class="va">synthetic_settings_5y_fairfield</span><span class="op">$</span><span class="va">all</span></span>
<span><span class="co">#&gt;               [0,5)    [5,10)   [10,15)    [15,20) [20,Inf)</span></span>
<span><span class="co">#&gt; [0,5)    1.05181207 0.3328449 0.0951143 0.06069717      Inf</span></span>
<span><span class="co">#&gt; [5,10)   0.35087372 4.6920504 0.5251319 0.09017305      Inf</span></span>
<span><span class="co">#&gt; [10,15)  0.10589455 0.5507981 6.7431490 0.57914280      Inf</span></span>
<span><span class="co">#&gt; [15,20)  0.07210516 0.1013027 0.6145379 4.91889407      Inf</span></span>
<span><span class="co">#&gt; [20,Inf)        Inf       Inf       Inf        Inf      Inf</span></span></code></pre></div>
<p>We can use <code>autoplot</code> to plot all at once</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># this code is erroring for the moment - something to do with rendering a large plot I think.</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span></span>
<span>  <span class="va">synthetic_settings_5y_fairfield</span>,</span>
<span>  title <span class="op">=</span> <span class="st">"Setting-specific synthetic contact matrices (fairfield 2020 projected)"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/fairfield-synth-5-plot-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="speeding-up-computation-with-future">Speeding up computation with <code>future</code><a class="anchor" aria-label="anchor" href="#speeding-up-computation-with-future"></a>
</h3>
<p><code>conmat</code> supports parallelisation, which is useful in a
couple of contexts with the model fitting, here is an example:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://future.futureverse.org" class="external-link">future</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://future.futureverse.org/reference/plan.html" class="external-link">plan</a></span><span class="op">(</span><span class="va">multisession</span>, workers <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<p>We set the future plan, saying “multisession”, with 4 workers. Then
we run the same code as above (note that you must specify the plan,
otherwise it does not know how to parallelise. See the <a href="https://future.futureverse.org/reference/plan.html" class="external-link">future package
documentation</a> for more details):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">contact_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/fit_setting_contacts.html">fit_setting_contacts</a></span><span class="op">(</span></span>
<span>  contact_data_list <span class="op">=</span> <span class="va">polymod_setting_data_small</span>,</span>
<span>  population <span class="op">=</span> <span class="va">polymod_survey_data_small</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">contact_model_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/predict_setting_contacts.html">predict_setting_contacts</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">polymod_survey_data_small</span>,</span>
<span>  contact_model <span class="op">=</span> <span class="va">contact_model</span>,</span>
<span>  age_breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, by <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, <span class="cn">Inf</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Notably this is about 3 times faster than without using that
plan.</p>
</div>
<div class="section level3">
<h3 id="extrapolate-from-all-polymod-data">Extrapolate from all POLYMOD data<a class="anchor" aria-label="anchor" href="#extrapolate-from-all-polymod-data"></a>
</h3>
<p>The above model fitting and prediction steps are all done on the full
POLYMOD data. But you could modify the polymod data used in the model,
to say be only for Finland, or Germany, or a specific age group.</p>
<p>However, if you want to predict to all settings, using the full
POLYMOD data, to a specific new age population, you can use
<code>extrapolate_polymod</code>, which takes arguments for a new
population, age breaks, and optionally household per capita size. By
default it uses 5 year age breaks from 0-75, then 75 and above.</p>
<p>We can demonstrate fitting a model using just Fairfield data, like
so:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute setting-specific and combined age matrices for polymod</span></span>
<span><span class="va">synthetic_settings_5y_fairfield</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrapolate_polymod.html">extrapolate_polymod</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">fairfield_age_pop</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">synthetic_settings_5y_fairfield</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-3-1.png" width="700"></p>
<p>We can also do the same, for the polymod data itself:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># compute setting-specific and combined age matrices for polymod</span></span>
<span><span class="va">polymod_population</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_polymod_population.html">get_polymod_population</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">synthetic_settings_5y_polymod</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrapolate_polymod.html">extrapolate_polymod</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">polymod_population</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">synthetic_settings_5y_polymod</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>And for fun we can compare some of the data together, say polymod
data for home against fairfield home, using the <code>patchwork</code>
package:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="va">gg_polymod_home</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">synthetic_settings_5y_polymod</span><span class="op">$</span><span class="va">home</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"polymod home"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_fairfield_home</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">synthetic_settings_5y_fairfield</span><span class="op">$</span><span class="va">home</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Fairfield home"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_polymod_home</span> <span class="op">+</span> <span class="va">gg_fairfield_home</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-5-1.png" width="700"></p>
<p>This might not look that different, but we can compare this to Alice
Springs</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">synthetic_settings_5y_alice</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/extrapolate_polymod.html">extrapolate_polymod</a></span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="fu"><a href="../reference/abs_age_data.html">abs_age_lga</a></span><span class="op">(</span><span class="st">"Alice Springs (T)"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_alice_home</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/autoplot.html" class="external-link">autoplot</a></span><span class="op">(</span><span class="va">synthetic_settings_5y_alice</span><span class="op">$</span><span class="va">home</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Alice Springs home"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gg_polymod_home</span> <span class="op">+</span> <span class="va">gg_alice_home</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-6-1.png" width="700"></p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">gg_polymod_home</span> <span class="op">+</span> <span class="va">gg_fairfield_home</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-6-2.png" width="700"></p>
<p>We can use some other functions from <code>socialmixr</code> to
extract similar estimates for different populations in different
countries.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">italy_2005</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://epiforecasts.io/socialmixr/reference/wpp_age.html" class="external-link">wpp_age</a></span><span class="op">(</span><span class="st">"Italy"</span>, <span class="st">"2005"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">italy_2005</span></span>
<span><span class="co">#&gt;    country lower.age.limit year population</span></span>
<span><span class="co">#&gt; 1    Italy               0 2005    2758749</span></span>
<span><span class="co">#&gt; 2    Italy               5 2005    2712790</span></span>
<span><span class="co">#&gt; 3    Italy              10 2005    2815246</span></span>
<span><span class="co">#&gt; 4    Italy              15 2005    2917476</span></span>
<span><span class="co">#&gt; 5    Italy              20 2005    3168918</span></span>
<span><span class="co">#&gt; 6    Italy              25 2005    3786584</span></span>
<span><span class="co">#&gt; 7    Italy              30 2005    4553115</span></span>
<span><span class="co">#&gt; 8    Italy              35 2005    4797005</span></span>
<span><span class="co">#&gt; 9    Italy              40 2005    4701976</span></span>
<span><span class="co">#&gt; 10   Italy              45 2005    4136438</span></span>
<span><span class="co">#&gt; 11   Italy              50 2005    3827458</span></span>
<span><span class="co">#&gt; 12   Italy              55 2005    3877700</span></span>
<span><span class="co">#&gt; 13   Italy              60 2005    3261850</span></span>
<span><span class="co">#&gt; 14   Italy              65 2005    3322436</span></span>
<span><span class="co">#&gt; 15   Italy              70 2005    2858787</span></span>
<span><span class="co">#&gt; 16   Italy              75 2005    2379461</span></span>
<span><span class="co">#&gt; 17   Italy              80 2005    1740071</span></span>
<span><span class="co">#&gt; 18   Italy              85 2005     709878</span></span>
<span><span class="co">#&gt; 19   Italy              90 2005     392976</span></span>
<span><span class="co">#&gt; 20   Italy              95 2005      82042</span></span>
<span><span class="co">#&gt; 21   Italy             100 2005       7525</span></span></code></pre></div>
<p>This italian population data could then be put into
<code>extrapolate_polymod</code> as above.</p>
</div>
</div>
<div class="section level2">
<h2 id="for-interests-sake-visualising-the-empirical-contact-rate-data">For interest’s sake: visualising the empirical contact rate
data<a class="anchor" aria-label="anchor" href="#for-interests-sake-visualising-the-empirical-contact-rate-data"></a>
</h2>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># visualise empirical contact rate estimates</span></span>
<span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/bind.html" class="external-link">bind_rows</a></span><span class="op">(</span></span>
<span>  home <span class="op">=</span> <span class="fu"><a href="../reference/get_polymod_contact_data.html">get_polymod_contact_data</a></span><span class="op">(</span><span class="st">"home"</span><span class="op">)</span>,</span>
<span>  school <span class="op">=</span> <span class="fu"><a href="../reference/get_polymod_contact_data.html">get_polymod_contact_data</a></span><span class="op">(</span><span class="st">"school"</span><span class="op">)</span>,</span>
<span>  work <span class="op">=</span> <span class="fu"><a href="../reference/get_polymod_contact_data.html">get_polymod_contact_data</a></span><span class="op">(</span><span class="st">"work"</span><span class="op">)</span>,</span>
<span>  other <span class="op">=</span> <span class="fu"><a href="../reference/get_polymod_contact_data.html">get_polymod_contact_data</a></span><span class="op">(</span><span class="st">"other"</span><span class="op">)</span>,</span>
<span>  .id <span class="op">=</span> <span class="st">"setting"</span></span>
<span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    rate <span class="op">=</span> <span class="va">contacts</span> <span class="op">/</span> <span class="va">participants</span>,</span>
<span>    setting <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>      <span class="va">setting</span>,</span>
<span>      levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="st">"home"</span>, <span class="st">"school"</span>, <span class="st">"work"</span>, <span class="st">"other"</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span></span>
<span>    <span class="va">setting</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    `relative contact rate` <span class="op">=</span> <span class="va">rate</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">rate</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>      x <span class="op">=</span> <span class="va">age_from</span>,</span>
<span>      y <span class="op">=</span> <span class="va">age_to</span>,</span>
<span>      fill <span class="op">=</span> <span class="va">`relative contact rate`</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link">facet_wrap</a></span><span class="op">(</span></span>
<span>    <span class="op">~</span> <span class="va">setting</span>,</span>
<span>    ncol <span class="op">=</span> <span class="fl">2</span>,</span>
<span>    scales <span class="op">=</span> <span class="st">"free"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span></span>
<span>    direction <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    trans <span class="op">=</span> <span class="st">"sqrt"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="getting-started_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Nicholas Tierney, Nick Golding, Aarathy Babu.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
